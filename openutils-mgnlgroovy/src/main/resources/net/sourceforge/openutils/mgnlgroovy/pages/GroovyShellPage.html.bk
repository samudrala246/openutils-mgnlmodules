<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <title>Groovy Shell Page</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link href="${this.request.contextPath}/.resources/groovyshell/css/mgnladmin.css" type="text/css" rel="stylesheet" />
    <link href="${this.request.contextPath}/.resources/groovyshell/css/styles.css" type="text/css" rel="stylesheet" />
    <script src="${this.request.contextPath}/.resources/groovyshell/js/codemirror/codemirror.js" type="text/javascript"></script>
    <script type="text/javascript">
      // <![[
        function uploadFile(){
          document.getElementById('command').value='loadGroovyScript'
            document.forms[0].submit()
        }
        function warnBeforeSubmit(){
          if(confirm('Are you sure you want to run this script?')){
                document.getElementById('groovyScript').value = editor.getCode()
                document.getElementById('runBtn').disabled=true
                document.forms[0].submit()
          }
            else
                return false
        }
        
        
        // ]]>
    </script>
  </head>
  <body class="ma">
    <div class="ma-frame">
      <form method="post" action="" enctype="multipart/form-data">
        <h2>
          Groovy Shell
          <a target="_blank" href="http://www.openmindonline.it" style="position:absolute;right:45px;">
            <img class="omlogo" alt="openmind" src="${this.request.contextPath}/.resources/groovyshell/img/openmind-logo.png" />
          </a>
        </h2>
        <div class="ma-framecenter">
          <div class="ma-warning">
            <strong>Warning</strong>
            : the Groovy Shell potentially makes at your disposal the entire Magnolia API. If not used properly and
            judiciously, this means that
            <strong>you could make permanent damages to your repository</strong>
            , such as delete all your data.
            <strong>Use it at your own risk.</strong>
          </div>
          <div class="ma-formel-container">
            <div class="ma-formel-left">
              <label for="groovyScriptFile">Upload groovy script</label>
            </div>
            <div class="ma-formel-right">
              <input type="file" name="groovyScriptFile" />
              <input type="submit" value="Upload" onclick="uploadFile()" class="mgnlControlButton" />
            </div>
          </div>
          <div class="ma-formel-container">
            <div class="ma-formel-right" id="textarecontainer">
              <textarea id="groovyScriptTxtArea" name="groovyScriptTxtArea" rows="30" cols="120" style="width:100%"
                class="codepress groovy readonly-off">${this.groovyScript!''}</textarea>
              <input type="hidden" name="groovyScript" id="groovyScript" value="" />
            </div>
          </div>
          <input type="hidden" id="command" name="command" value="executeGroovyScript" />
          [#if message?exists]
          <pre class="ma-info">${message}</pre>
          [/#if]
        </div>
        <div class="ma-framefooter">
          <div class="ma-framefooterinner">
            <div class="ma-buttons">
              <input type="submit" id="runBtn" value="Run" onclick="warnBeforeSubmit(); return false" class="mgnlControlButton" />
            </div>
          </div>
        </div>
      </form>
    </div>
    <script type="text/javascript">
        // <![CDATA[
  var editor = CodeMirror.fromTextArea('groovyScriptTxtArea', {
    height: "dynamic",
    minHeight: 405,
    basefiles: ["${this.request.contextPath}/.resources/groovyshell/js/codemirror/codemirror_groovy.js"],
    stylesheet: "${this.request.contextPath}/.resources/groovyshell/js/codemirror/groovycolors.css",
    textWrapping: false,
    lineNumbers: true
  });
  // ]]>
</script>
  </body>
</html>