<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <link rel="stylesheet" type="text/css" href="${this.request.contextPath}/.resources/media/css/folderView.css" />
    <link rel="stylesheet" type="text/css" href="${this.request.contextPath}/.resources/media/css/multibox.css" />
    <!--
      [if IE]><style> .image span { display: inline-block; height: 100%; } </style><![endif]
    -->
    <script type="text/javascript" src="${this.request.contextPath}/.resources/media/js/mootools-1.2-core.js"></script>
    <script type="text/javascript" src="${this.request.contextPath}/.resources/media/js/mootools-1.2-more.js"></script>
    <script type="text/javascript" src="${this.request.contextPath}/.resources/media/js/mootips.js"></script>
    <script type="text/javascript" src="${this.request.contextPath}/.resources/media/js/multibox/multibox.js"></script>
    <script type="text/javascript" src="${this.request.contextPath}/.resources/media/js/multibox/overlay.js"></script>
    <script type="text/javascript"> <#list this.types as type> <#if type.name == this.type> <#assign currentType = type> </#if> </#list>

    function openDialog(path) {
      parent.openWindow(".magnolia/dialogs/${currentType.dialog}.html?mgnlPath=" + path
        + "&mgnlRepository=media");
    }

    function openMediaTree(action, path) {
      parent.openWindow(".magnolia/pages/mediaFolderSelection.html?sourceNode="+ path +"&action="+ action +"&mgnlCK=" + (new Date()).getTime());
    }

    function performAction(action, source, dest)
    {
      if (action == "move" && dest == "${this.path}")
      {
        alert("Non Ã¨ possibile spostare all'interno dello stesso nodo.");
        return;
      }
      $("actionCmd").value = action;
      $("actionNode").value = source;
      $("actionDest").value = dest;
      $("actionForm").submit();
    }

    function deleteMedia(source) {
      if (confirm("${this.msgs.get('media.alert.delete')}"))
      {
        performAction("delete", source, "");
      }
    }

    function selectMedia(uuid, thumb, file)
    {
      parent.setNewMedia(uuid, thumb, file);
    }

    var isTreeCollapsed = false;

    window.addEvent('domready', function(){
      var multibox = new MultiBox('multibox', {
         path: '${this.request.contextPath}/.resources/media/players/',
       useOverlay: true,
         onOpen: function(){
          isTreeCollapsed = parent.isTreeCollapsed();
          if (!isTreeCollapsed)
          {
            parent.setTreeCollapsed(true);
          }
         },
         onClose: function(){
          if (!isTreeCollapsed)
          {
            parent.setTreeCollapsed(false);
          }
         }
      });

      var Tips1 = new TipsEx($$('.tips'), {
        fixed: true,
        onShow: function(tip) {
          tip.setStyle('opacity', 0.95);
        },
        onHide: function(tip) {
          tip.fade('out');
        },
        showDelay: 100,
        hideDelay: 200
      });

    });

    </script>
  </head>
  <body>
    <form action="" style="display:none" id="actionForm">
      <input type="hidden" id="actionCmd" name="command" value="delete" />
      <input type="hidden" id="actionPath" name="path" value="${this.path}" />
      <input type="hidden" id="actionNode" name="node" />
      <input type="hidden" id="actionDest" name="dest" />
      <input type="hidden" name="type" value="${this.type}" />
    </form>
    <div id="navigation">
      <#list this.types as type> <#if type.name == this.type> <#assign actual = "actual"> <#else> <#assign actual = "">
      </#if>
      <div class="voice ${actual}">
        <#if this.request.parameterMap['selectMedia']?exists>
        <a href="?type=${type.name}&path=${this.path}&selectMedia=true">
          <img src="${this.request.contextPath}${type.menuIcon}" border="0" align="absmiddle" />
          ${type.label} (${this.numberOfMedia[type.name]})
        </a>
        <#else>
        <a href="?type=${type.name}&path=${this.path}">
          <img src="${this.request.contextPath}${type.menuIcon}" border="0" align="absmiddle" />
          ${type.label} (${this.numberOfMedia[type.name]})
        </a>
        </#if>
      </div>
      <div class="separator">|</div>
      </#list>
    </div>
    <br />
    <ul class="mediaList">
      <#assign index = 0>
      <#list this.medias as media>
        <#if media.filename?length gt 18>
          <#assign name = media.filename?substring(0,15)>
          <#assign name = name?right_pad(18, ".")>
        <#else>
          <#assign name = media.filename>
        </#if>
        <#assign index = index + 1 >
        <#assign mediaStatusClass = "">
        <#if this.selectMedia && !this.develop>
          <#assign mediaStatusClass = "mediaStatus${media.metaData.activationStatus}">
        </#if>
      <li class="media ${mediaStatusClass}" style="text-align:center">
        <div class="imageBorder">
          <div class="image">
            <span></span>
            <!--
            <a href="${this.request.contextPath}${media.previewUrl}" rel="lightbox[test]" title="${media.description!""}">
              <img src="${this.request.contextPath}${media.thumbnailUrl}" border="0" alt="" />
            </a>
             -->
            <a id="mb${index}" class="multibox" href="${this.request.contextPath}${media.previewUrl}" title="${media.description!""}">
              <img src="${this.request.contextPath}${media.thumbnailUrl}" border="0" alt="" />
            </a>
          </div>
        </div>
        <div class="icons">
          <#if this.selectMedia>
            <#if media.metaData.activationStatus = 2 || this.develop >
            <a href="javascript:$empty()" onclick="selectMedia('${media.uuid}', '${this.request.contextPath}${media.thumbnailUrl}', '${media.filename}')" title="modifica">
              seleziona
            </a>
            <#else>
              <#if this.canPublish && media.metaData.activationStatus &lt; 2>
              <a href="javascript:void()" onclick="performAction('activate', '${media.handle}','')" title="pubblica">
                <img src="${this.request.contextPath}/.resources/icons/16/arrow_right_green.gif" border="0" align="middle" />
              </a>
              <#else>
              not published
              </#if>
            </#if>
          <#else>
            <#if this.writable>
            <a href="javascript:$empty()" onclick="openDialog('${media.handle}')" title="modifica">
              <img src="${this.request.contextPath}/.resources/media/icons/ico16-edit.png" border="0" align="middle" />
            </a>
            <a href="javascript:$empty()" onclick="deleteMedia('${media.handle}')" title="elimina">
              <img src="${this.request.contextPath}/.resources/icons/16/delete2.gif" border="0" align="middle" />
            </a>
            <a href="javascript:void()" onclick="openMediaTree('move','${media.handle}')" title="sposta">
              <img src="${this.request.contextPath}/.resources/icons/16/up_down.gif" border="0" align="middle" />
            </a>
            <a href="javascript:void()" onclick="openMediaTree('copy','${media.handle}')" title="copia">
              <img src="${this.request.contextPath}/.resources/icons/16/copy.gif" border="0" align="middle" />
            </a>
            <#else>
            <a>
              <img src="${this.request.contextPath}/.resources/media/icons/ico16-edit_inactive.png" border="0" align="middle" />
            </a>
            <a>
              <img src="${this.request.contextPath}/.resources/icons/16/delete2_inactive.gif" border="0" align="middle" />
            </a>
            <a>
              <img src="${this.request.contextPath}/.resources/icons/16/up_down_inactive.gif" border="0" align="middle" />
            </a>
            <a>
              <img src="${this.request.contextPath}/.resources/icons/16/copy_inactive.gif" border="0" align="middle" />
            </a>
            </#if>
            <#if this.canPublish>
            <a href="javascript:void()" onclick="performAction('activate', '${media.handle}','')" title="pubblica">
              <img src="${this.request.contextPath}/.resources/icons/16/arrow_right_green.gif" border="0" align="middle" />
            </a>
            <#else>
            <a title="pubblica">
              <img src="${this.request.contextPath}/.resources/media/icons/ico16-arrow_right_inactive.png" border="0"
                align="middle" />
            </a>
            </#if>
            <#if this.canPublish && media.metaData.activationStatus = 2>
            <a href="javascript:void()" onclick="performAction('deactivate', '${media.handle}','')" title="depubblica">
              <img src="${this.request.contextPath}/.resources/icons/16/arrow_left_red.gif" border="0" align="middle" />
            </a>
            <#else>
            <a title="depubblica">
              <img src="${this.request.contextPath}/.resources/icons/16/arrow_left_red_inactive.gif" border="0"
                align="middle" />
            </a>
            </#if>
          </#if>
        </div>
        <div class="used">
          <#if media.usedInWebPages?size = 0>
          <span>Non utilizzato</span>
          <#else>
          <#assign pages = "">
          <#list media.usedInWebPages as page>
            <#assign pages = pages + "&lt;a href=&apos;${this.request.contextPath}" + page +".html&apos; target=&apos;_blank&apos;&gt;"+ page +"&lt;/a&gt;&lt;br/&gt;">
          </#list>
          <span class="tips" rel="${pages}">Pagine (${media.usedInWebPages?size})</span>
          </#if>
        </div>
        <span class="name status${media.metaData.activationStatus}" title="${media.filename}">${name}</span>
      </li>
      </#list>
    </ul>
  </body>
</html>